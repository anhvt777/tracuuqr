<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BIDV QR Thue PNN</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f6fa;color:#222}
  header{
    background:teal;
    padding:10px 16px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    text-align:center;
    position:fixed;
    top:0;left:0;right:0;
    z-index:1000
  }
  header .title{font-size:18px;font-weight:700;color:#fff}
  header .meta{font-size:13px;color:#FFD700}
  .marquee{
    background:#FFC62F;
    color:#000;
    padding:6px 10px;
    overflow:hidden;
    white-space:nowrap;
    position:fixed;
    top:80px;left:0;right:0;
    z-index:999;
    text-align:center
  }
  .marquee span{display:inline-block;padding-left:100%;animation:marq 40s linear infinite}
  @keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}  
  .container{max-width:1100px;margin:140px auto 18px auto;padding:12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
  .controls .left{display:flex;gap:8px;flex:1;min-width:300px}
  input[type=text],select{padding:8px;border-radius:6px;border:1px solid #ccc;font-size:14px}
  button{background:teal;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
  table{width:100%;border-collapse:collapse;background:white;border-radius:6px;overflow:hidden}
  th,td{padding:8px;text-align:left;border-bottom:1px solid #eee;font-size:13px}
  th{background:#f0f7fb;color:teal;font-weight:600}
  td.amount{text-align:right;font-weight:600}
  tr:hover{background:#fafafa;cursor:pointer}
  .pager{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
  #qrcode{margin-top:18px;text-align:center;background:white;padding:12px;border-radius:8px}
  .meta{font-size:13px}
  @media(max-width:700px){.controls{flex-direction:column;align-items:stretch}input[type=text],select{width:100%}table,th,td{font-size:12px}}
</style>
</head>
<body>
<header>
  <div class="title">BIDV - PGD ƒê∆∞·ªùng 9 - Tra c·ª©u &amp; T·∫°o QR thanh to√°n Thu·∫ø PNN Ph∆∞·ªùng ƒê√¥ng H√†</div>
  <div class="meta">T√¨m ki·∫øm theo t√™n NNT, ƒë·ªëi chi·∫øu th√¥ng tin, ch·ªçn ƒë·ªÉ sinh QR</div>
</header>
<div class="marquee"><span>BIDV ƒë·ªìng h√†nh c√πng thu·∫ø Nh√† n∆∞·ªõc ‚Äì N·ªôp thu·∫ø nhanh ch√≥ng qua QR Code           üéâ ∆Øu ƒë√£i ƒë·∫∑c bi·ªát: T·∫∂NG TI·ªÄN khi m·ªü T√†i kho·∫£n BIDV | T·∫∂NG LOA TH√îNG B√ÅO CHO H·ªò KD, T·∫∂NG TI·ªÄN l√™n ƒë·∫øn 600.000 VNƒê v√†o TK | L√£i su·∫•t vay ∆∞u ƒë√£i ch·ªâ t·ª´ 4,5%/nƒÉm | Li√™n h·ªá Mr. M·∫°nh H√πng (0914 179 989) ƒë·ªÉ bi·∫øt th√™m chi ti·∫øt üéâ</span></div>
<div class="container">
  <div class="controls">
    <div class="left">
      <input id="searchInput" type="text" placeholder="T√¨m theo T√™n t√†i kho·∫£n (c·ªôt E) ho·∫∑c M√£ s·ªë thu·∫ø (c·ªôt G)..." />
      <select id="phuongSelect"><option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option></select>
      <select id="thonSelect"><option value="">-- Ch·ªçn Th√¥n/T·ªï  --</option></select>
    </div>
    <div class="right">
      <button id="clearBtn">X√≥a b·ªô l·ªçc</button>
    </div>
  </div>

  <div id="qrcode"><div class="meta">Ch·ªçn 1 d√≤ng ƒë·ªÉ hi·ªÉn th·ªã QR VietQR</div></div>

  <div id="stats" class="meta">ƒêang t·∫£i d·ªØ li·ªáu...</div>

  <table id="resultTable" aria-live="polite">
    <thead>
      <tr><th style="width:160px">S·ªë TK</th><th>T√™n t√†i kho·∫£n</th><th style="width:120px">S·ªë ti·ªÅn</th><th style="width:160px">MST / N·ªôi dung</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pager">
    <button id="prevBtn">Trang tr∆∞·ªõc</button>
    <div id="pageInfo" class="meta"></div>
    <button id="nextBtn">Trang sau</button>
  </div>

  <div id="qrcode"><div class="meta">Ch·ªçn 1 d√≤ng ƒë·ªÉ hi·ªÉn th·ªã QR VietQR</div></div>
</div>

<script>
fetch("data.json")
  .then(res => res.json())
  .then(data => {
let filtered = data.slice();
let page = 1;
const perPage = 10;

const tbody = document.querySelector('#resultTable tbody');
const searchInput = document.getElementById('searchInput');
const phuongSelect = document.getElementById('phuongSelect');
const thonSelect = document.getElementById('thonSelect');
const pageInfo = document.getElementById('pageInfo');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const stats = document.getElementById('stats');
const clearBtn = document.getElementById('clearBtn');
const qrcodeDiv = document.getElementById('qrcode');

function init(){
  populatePhuongOptions();
  updateStats();
  render();
  attachEvents();
}

function populatePhuongOptions(){
  const set = new Set();
  data.forEach(r=>{ if(r['PH∆Ø·ªúNG/X√É']) set.add(r['PH∆Ø·ªúNG/X√É']); });
  const arr = Array.from(set).filter(v=>v).sort((a,b)=>a.localeCompare(b,'vi'));
  arr.forEach(v=>{ const opt=document.createElement('option'); opt.value=v; opt.textContent=v; phuongSelect.appendChild(opt); });
  phuongSelect.addEventListener('change', ()=>{ populateThonOptions(phuongSelect.value); searchAndRender(); });
  populateThonOptions('');
}

function populateThonOptions(phuong){
  thonSelect.innerHTML = '<option value="">-- Ch·ªçn Th√¥n/T·ªï --</option>';
  const set = new Set();
  data.forEach(r=>{
    if(r['TH√îN/T·ªî/KHU PH·ªê']){
      if(!phuong || (r['PH∆Ø·ªúNG/X√É']===phuong)) set.add(r['TH√îN/T·ªî/KHU PH·ªê']);
    }
  });
  const arr = Array.from(set).filter(v=>v).sort((a,b)=>a.localeCompare(b,'vi'));
  arr.forEach(v=>{ const opt=document.createElement('option'); opt.value=v; opt.textContent=v; thonSelect.appendChild(opt); });
  thonSelect.addEventListener('change', ()=>searchAndRender());
}

function searchAndRender(){
  const kw = searchInput.value.trim().toLowerCase();
  const ph = phuongSelect.value;
  const th = thonSelect.value;
  filtered = data.filter(r=>{
    const name = (r['AccountName']||'').toString().toLowerCase();
    const mst = (r['MST']||'').toString().toLowerCase();
    const matchSearch = !kw || name.includes(kw) || mst.includes(kw);
    const matchPh = !ph || (r['PH∆Ø·ªúNG/X√É']===ph);
    const matchTh = !th || (r['TH√îN/T·ªî/KHU PH·ªê']===th);
    return matchSearch && matchPh && matchTh;
  });
  page = 1;
  updateStats();
  render();
}

function render(){
  tbody.innerHTML='';
  const total = filtered.length;
  const totalPages = Math.max(1, Math.ceil(total/perPage));
  const start = (page-1)*perPage;
  const end = Math.min(total, start+perPage);
  const pageData = filtered.slice(start,end);
  pageInfo.textContent = `Hi·ªÉn th·ªã ${start+1}-${end} trong ${total} (Trang ${page}/${totalPages})`;
  pageData.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(r['AccountNumber']||'')}</td>
                    <td>${escapeHtml(r['AccountName']||'')}</td>
                    <td class="amount">${formatAmount(r['Amount']||'')}</td>
                    <td>${escapeHtml(r['MST']||'')}</td>`;
    tr.addEventListener('click', ()=>showQR(r));
    tbody.appendChild(tr);
  });
}

function showQR(row){
  qrcodeDiv.innerHTML='';
  const url = `https://img.vietqr.io/image/${encodeURIComponent(row['BankBin']||'')}-${encodeURIComponent(row['AccountNumber']||'')}-compact2.png?amount=${encodeURIComponent(row['Amount']||'')}&addInfo=${encodeURIComponent(row['Remark']||'')}&accountName=${encodeURIComponent(row['AccountName']||'')}`;
  const img = document.createElement('img');
  img.src = url;
  img.alt = 'QR Code';
  img.style.width='100%';
  img.style.maxWidth='360px';
  const info = document.createElement('div');
  info.style.marginTop='8px';
  info.innerHTML = `<strong>${escapeHtml(row['AccountName']||'')}</strong><br>S·ªë TK: ${escapeHtml(row['AccountNumber']||'')} &nbsp; | &nbsp; S·ªë ti·ªÅn: ${formatAmount(row['Amount']||'')} VND<br><em>${escapeHtml(row['Remark']||'')}</em>`;
  qrcodeDiv.appendChild(img);
  qrcodeDiv.appendChild(info);
  const a = document.createElement('a');
  a.href = url;
  a.download = `qr_${(row['AccountNumber']||'')}.png`;
  a.textContent = '‚¨á T·∫£i ·∫£nh QR';
  a.style.display='inline-block';
  a.style.marginTop='8px';
  a.style.background='teal'; a.style.color='white'; a.style.padding='6px 10px'; a.style.borderRadius='6px'; a.style.textDecoration='none';
  qrcodeDiv.appendChild(document.createElement('br'));
  qrcodeDiv.appendChild(a);
}

function updateStats(){ stats.textContent = `T·ªïng b·∫£n ghi: ${data.length}`; }

prevBtn.addEventListener('click', ()=>{ if(page>1){page--; render();}});
nextBtn.addEventListener('click', ()=>{ const tot=Math.ceil(filtered.length/perPage); if(page<tot){page++; render();}});

function attachEvents(){
  searchInput.addEventListener('input', ()=>{ searchAndRender(); });
  clearBtn.addEventListener('click', ()=>{ searchInput.value=''; phuongSelect.value=''; populateThonOptions(''); thonSelect.value=''; searchAndRender(); });
}

function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }
function formatAmount(x){ 
  const n = parseInt(x||0,10); 
  return isNaN(n)?'': n.toLocaleString('vi-VN'); 
}

setTimeout(init,100);
  });
</script>
</body>
</html>
